{"version":3,"sources":["App.js","reportWebVitals.js","index.js"],"names":["Wrapper","styled","div","LocalStream","SettingForm","StreamRooms","Buttons","StreamRoom","id","user","uid","ClientSettings","settings","setSettings","handleChange","name","event","target","value","htmlFor","type","appId","onChange","channel","token","App","useState","localUser","setLocalUser","remoteUsers","setRemoteUsers","client","setClient","appID","join","useCallback","a","AgoraRTC","createClient","mode","codec","on","currUsers","find","I","mediaType","toast","info","subscribe","videoTrack","play","toString","audioTrack","warning","filter","createMicrophoneAudioTrack","createCameraVideoTrack","publish","error","message","leave","close","show","setEnabled","hide","unpublish","mute","unmute","useAgroaClient","position","onClick","map","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"q8BAOA,IAAMA,EAAUC,IAAOC,IAAV,KAQPC,EAAcF,IAAOC,IAAV,KAKXE,EAAcH,IAAOC,IAAV,KAMXG,EAAcJ,IAAOC,IAAV,KAIXI,EAAUL,IAAOC,IAAV,KAUPK,EAAa,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,GAAIC,EAAW,EAAXA,KAClBC,EAAMF,GAAMC,EAAKC,IACvB,OACE,gCACGD,GAAQ,sCAASC,KAClB,cAACP,EAAD,CAAaK,GAAIE,QAKjBC,EAAiB,SAAC,GAA+B,IAA7BC,EAA4B,EAA5BA,SAAUC,EAAkB,EAAlBA,YAC5BC,EAAe,SAAAC,GAAI,OAAI,SAAAC,GAAK,OAChCH,GAAY,SAAAD,GAAQ,kCAAUA,GAAV,kBAAqBG,EAAOC,EAAMC,OAAOC,aAE/D,OACE,eAACd,EAAD,WACE,gCACE,uBAAOe,QAAQ,QAAf,mBACA,uBACEX,GAAG,QACHY,KAAK,OACLL,KAAK,QACLG,MAAON,EAASS,MAChBC,SAAUR,EAAa,cAG3B,gCACE,uBAAOK,QAAQ,UAAf,qBACA,uBACEX,GAAG,UACHY,KAAK,OACLL,KAAK,UACLG,MAAON,EAASW,QAChBD,SAAUR,EAAa,gBAG3B,gCACE,uBAAOK,QAAQ,QAAf,mBACA,uBACEX,GAAG,QACHY,KAAK,OACLL,KAAK,QACLG,MAAON,EAASY,MAChBF,SAAUR,EAAa,kBA0LlBW,EA/CH,WAAO,IAAD,EACkBC,qBADlB,mBACTC,EADS,KACEC,EADF,OAEsBF,mBAAS,IAF/B,mBAETG,EAFS,KAEIC,EAFJ,OAGYJ,qBAHZ,mBAGTK,EAHS,KAGDC,EAHC,OAIgBN,mBAAS,CACvCO,MAAO,GACPV,QAAS,GACTC,MAAO,KAPO,mBAITZ,EAJS,KAICC,EAJD,OApIK,SAAC,GAOjB,IANLkB,EAMI,EANJA,OACAJ,EAKI,EALJA,UACAf,EAII,EAJJA,SACAgB,EAGI,EAHJA,aACAI,EAEI,EAFJA,UACAF,EACI,EADJA,eAoHA,MAAO,CACLI,KAnHWC,sBAAW,sBAAC,wCAAAC,EAAA,6DACjBL,EAASM,IAASC,aAAa,CACnCC,KAAM,MACNC,MAAO,UAIFC,GAAG,cAAV,uCAAyB,WAAMhC,GAAN,SAAA2B,EAAA,sDAGvBN,GAAe,SAAAY,GAEb,OAAKA,EAAUC,MAAK,SAAAC,GAAC,OAAIA,EAAElC,MAAQD,EAAKC,OAG/BgC,EAFD,GAAN,mBAAWA,GAAX,CAAsBjC,OANH,2CAAzB,uDAcAsB,EAAOU,GAAG,iBAAV,uCAA4B,WAAOhC,EAAMoC,GAAb,SAAAT,EAAA,6DAC1BU,IAAMC,KAAN,0BAA8BtC,EAAKC,IAAnC,YAA0CmC,IADhB,SAGpBd,EAAOiB,UAAUvC,EAAMoC,GAHH,OAKR,UAAdA,EACFpC,EAAKwC,WAAWC,KAAKzC,EAAKC,IAAIyC,YACP,UAAdN,GACTpC,EAAK2C,WAAWF,OARQ,2CAA5B,yDAaAnB,EAAOU,GAAG,mBAAV,uCAA8B,WAAOhC,EAAMoC,GAAb,SAAAT,EAAA,sDAC5BU,IAAMO,QAAN,4BAAmC5C,EAAKC,IAAxC,YAA+CmC,IADnB,2CAA9B,yDAKAd,EAAOU,GAAG,YAAV,uCAAuB,WAAOhC,EAAMoC,GAAb,SAAAT,EAAA,sDACrBN,GAAe,SAAAY,GAAS,OAAIA,EAAUY,QAAO,SAAAV,GAAC,OAAIA,EAAElC,MAAQD,EAAKC,UAD5C,2CAAvB,yDAvCuB,SA4CbW,EAA0BT,EAA1BS,MAAOE,EAAmBX,EAAnBW,QAASC,EAAUZ,EAAVY,MA5CH,SA6CHO,EAAOG,KAAKb,EAAOE,EAASC,GA7CzB,cA6Cfd,EA7Ce,iBA8CI2B,IAASkB,6BA9Cb,eA8CfH,EA9Ce,iBA+CIf,IAASmB,yBA/Cb,eA+CfP,EA/Ce,QAiDVC,KAAK,cAChBtB,EAAa,CAAElB,MAAK0C,aAAYH,eAlDX,UAoDflB,EAAO0B,QAAQ,CAACL,EAAYH,IApDb,eAqDrBH,IAAMC,KAAK,yBACXf,EAAUD,GAtDW,kBAuDdA,GAvDc,yCA0DrBe,IAAMY,MAAN,kCAAY,KAAGC,SA1DM,kBA2Dd,IA3Dc,0DA6DtB,CAAC3B,EAAWJ,EAAcE,EAAgBlB,IAuD3CgD,MArDYzB,sBAAW,sBAAC,sBAAAC,EAAA,sEAEtBT,EAAUyB,WAAWS,QACrBlC,EAAUsB,WAAWY,QACrB7B,EAAU,MACVJ,EAAa,MACbE,EAAe,IANO,SAOhBC,EAAO6B,QAPS,yDAUtBd,IAAMY,MAAN,kCAAY,KAAGC,SAVO,0DAYvB,CAAChC,EAAWK,EAAWJ,EAAcE,EAAgBC,IA0CtD+B,KAxCW3B,sBAAW,sBAAC,sBAAAC,EAAA,+EAEfT,EAAUsB,WAAWc,YAAW,GAFjB,gCAGdhC,EAAO0B,QAAQ,CAAC9B,EAAUsB,cAHZ,gCAMrBH,IAAMY,MAAN,kCAAY,KAAGC,SANM,wDAQtB,CAAChC,EAAWI,IAiCbiC,KA/BW7B,sBAAW,sBAAC,sBAAAC,EAAA,+EAEfT,EAAUsB,WAAWc,YAAW,GAFjB,gCAGdhC,EAAOkC,UAAU,CAACtC,EAAUsB,cAHd,gCAKrBH,IAAMY,MAAN,kCAAY,KAAGC,SALM,wDAOtB,CAAChC,EAAWI,IAyBbmC,KAvBW/B,sBAAW,sBAAC,sBAAAC,EAAA,wFAEdL,EAAOkC,UAAU,CAACtC,EAAUyB,cAFd,gCAKrBN,IAAMY,MAAN,kCAAY,KAAGC,SALM,wDAOtB,CAAChC,EAAWI,IAiBboC,OAfahC,sBAAW,sBAAC,sBAAAC,EAAA,wFAEhBL,EAAO0B,QAAQ,CAAC9B,EAAUyB,cAFV,gCAKvBN,IAAMY,MAAN,kCAAY,KAAGC,SALQ,wDAOxB,CAAChC,EAAWI,KAsBmCqC,CAAe,CAC/DrC,SACAJ,YACAf,WACAgB,eACAI,YACAF,mBANMI,EAVQ,EAURA,KAAM0B,EAVE,EAUFA,MAAOE,EAVL,EAUKA,KAAME,EAVX,EAUWA,KAAME,EAVjB,EAUiBA,KAAMC,EAVvB,EAUuBA,OASvC,OACE,eAACnE,EAAD,WACE,cAAC,IAAD,CAAgBqE,SAAS,gBACzB,+CACA,cAAC,EAAD,CAAgBzD,SAAUA,EAAUC,YAAaA,IACjD,cAACP,EAAD,UACIyB,EAGA,qCACE,wBAAQuC,QAASV,EAAjB,mBACA,wBAAQU,QAASR,EAAjB,kBACA,wBAAQQ,QAASN,EAAjB,kBACA,wBAAQM,QAASJ,EAAjB,kBACA,wBAAQI,QAASH,EAAjB,uBAPF,wBAAQG,QAASpC,EAAjB,oBAWJ,eAAC7B,EAAD,WACE,cAAC,EAAD,CAAYG,GAAG,aAAaC,KAAMkB,IADpC,OAEGE,QAFH,IAEGA,OAFH,EAEGA,EAAa0C,KAAI,SAAA9D,GAAI,OACpB,cAAC,EAAD,CAA2BA,KAAMA,GAAhBA,EAAKC,eC1PjB8D,EAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,6BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCDdQ,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,SAM1Bb,M","file":"static/js/main.418eed17.chunk.js","sourcesContent":["import React, { useState, useCallback } from 'react'\nimport { ToastContainer, toast } from 'react-toastify'\nimport AgoraRTC from 'agora-rtc-sdk-ng'\nimport styled from 'styled-components'\n\nimport 'react-toastify/dist/ReactToastify.css'\n\nconst Wrapper = styled.div`\n  max-width: 960px;\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`\n\nconst LocalStream = styled.div`\n  width: 180px;\n  height: 120px;\n`\n\nconst SettingForm = styled.div`\n  label {\n    display: block;\n  }\n`\n\nconst StreamRooms = styled.div`\n  display: flex;\n`\n\nconst Buttons = styled.div`\n  margin-top: 6px;\n  display: flex;\n  justify-content: center;\n\n  button + button {\n    margin-left: 6px;\n  }\n`\n\nconst StreamRoom = ({ id, user }) => {\n  const uid = id || user.uid\n  return (\n    <div>\n      {user && <p>uid: {uid}</p>}\n      <LocalStream id={uid} />\n    </div>\n  )\n}\n\nconst ClientSettings = ({ settings, setSettings }) => {\n  const handleChange = name => event =>\n    setSettings(settings => ({ ...settings, [name]: event.target.value }))\n\n  return (\n    <SettingForm>\n      <div>\n        <label htmlFor=\"appId\">appId</label>\n        <input\n          id=\"appId\"\n          type=\"text\"\n          name=\"appId\"\n          value={settings.appId}\n          onChange={handleChange('appId')}\n        />\n      </div>\n      <div>\n        <label htmlFor=\"channel\">Channel</label>\n        <input\n          id=\"channel\"\n          type=\"text\"\n          name=\"channel\"\n          value={settings.channel}\n          onChange={handleChange('channel')}\n        />\n      </div>\n      <div>\n        <label htmlFor=\"token\">Token</label>\n        <input\n          id=\"token\"\n          type=\"text\"\n          name=\"token\"\n          value={settings.token}\n          onChange={handleChange('token')}\n        />\n      </div>\n    </SettingForm>\n  )\n}\n\nconst useAgroaClient = ({\n  client,\n  localUser,\n  settings,\n  setLocalUser,\n  setClient,\n  setRemoteUsers\n}) => {\n  const join = useCallback(async () => {\n    const client = AgoraRTC.createClient({\n      mode: 'rtc',\n      codec: 'h264'\n    })\n\n    // remote publish\n    client.on('user-joined', async user => {\n      // Initiate the subscription\n      // await client.subscribe(user, mediaType)\n      setRemoteUsers(currUsers => {\n        // only add non exist users\n        if (!currUsers.find(I => I.uid === user.uid)) {\n          return [...currUsers, user]\n        } else {\n          return currUsers\n        }\n      })\n    })\n\n    // remote publish\n    client.on('user-published', async (user, mediaType) => {\n      toast.info(`user-published: ${user.uid} ${mediaType}`)\n      // Initiate the subscription\n      await client.subscribe(user, mediaType)\n      // setRemoteUsers(currUsers => [...currUsers])\n      if (mediaType === 'video') {\n        user.videoTrack.play(user.uid.toString())\n      } else if (mediaType === 'audio') {\n        user.audioTrack.play()\n      }\n    })\n\n    // remote user unpublished\n    client.on('user-unpublished', async (user, mediaType) => {\n      toast.warning(`user-unpublished: ${user.uid} ${mediaType}`)\n    })\n\n    // remote user unpublished\n    client.on('user-left', async (user, mediaType) => {\n      setRemoteUsers(currUsers => currUsers.filter(I => I.uid !== user.uid))\n    })\n\n    try {\n      const { appId, channel, token } = settings\n      const uid = await client.join(appId, channel, token)\n      const audioTrack = await AgoraRTC.createMicrophoneAudioTrack()\n      const videoTrack = await AgoraRTC.createCameraVideoTrack()\n\n      videoTrack.play('local-user')\n      setLocalUser({ uid, audioTrack, videoTrack })\n\n      await client.publish([audioTrack, videoTrack])\n      toast.info('join channel success!')\n      setClient(client)\n      return client\n    } catch (e) {\n      /* handle error */\n      toast.error(e?.message)\n      return {}\n    }\n  }, [setClient, setLocalUser, setRemoteUsers, settings])\n\n  const leave = useCallback(async () => {\n    try {\n      localUser.audioTrack.close()\n      localUser.videoTrack.close()\n      setClient(null)\n      setLocalUser(null)\n      setRemoteUsers([])\n      await client.leave()\n    } catch (e) {\n      /* handle error */\n      toast.error(e?.message)\n    }\n  }, [localUser, setClient, setLocalUser, setRemoteUsers, client])\n\n  const show = useCallback(async () => {\n    try {\n      await localUser.videoTrack.setEnabled(true)\n      return client.publish([localUser.videoTrack])\n    } catch (e) {\n      /* handle error */\n      toast.error(e?.message)\n    }\n  }, [localUser, client])\n\n  const hide = useCallback(async () => {\n    try {\n      await localUser.videoTrack.setEnabled(false)\n      return client.unpublish([localUser.videoTrack])\n    } catch (e) {\n      toast.error(e?.message)\n    }\n  }, [localUser, client])\n\n  const mute = useCallback(async () => {\n    try {\n      return client.unpublish([localUser.audioTrack])\n    } catch (e) {\n      /* handle error */\n      toast.error(e?.message)\n    }\n  }, [localUser, client])\n\n  const unmute = useCallback(async () => {\n    try {\n      return client.publish([localUser.audioTrack])\n    } catch (e) {\n      /* handle error */\n      toast.error(e?.message)\n    }\n  }, [localUser, client])\n\n  return {\n    join,\n    leave,\n    show,\n    hide,\n    mute,\n    unmute\n  }\n}\n\nconst App = () => {\n  const [localUser, setLocalUser] = useState()\n  const [remoteUsers, setRemoteUsers] = useState([])\n  const [client, setClient] = useState()\n  const [settings, setSettings] = useState({\n    appID: '',\n    channel: '',\n    token: ''\n  })\n\n  const { join, leave, show, hide, mute, unmute } = useAgroaClient({\n    client,\n    localUser,\n    settings,\n    setLocalUser,\n    setClient,\n    setRemoteUsers\n  })\n\n  return (\n    <Wrapper>\n      <ToastContainer position=\"bottom-left\" />\n      <h1>Run The World</h1>\n      <ClientSettings settings={settings} setSettings={setSettings} />\n      <Buttons>\n        {!client ? (\n          <button onClick={join}>Join</button>\n        ) : (\n          <>\n            <button onClick={leave}>Leave</button>\n            <button onClick={show}>Show</button>\n            <button onClick={hide}>Hide</button>\n            <button onClick={mute}>Mute</button>\n            <button onClick={unmute}>Unmute</button>\n          </>\n        )}\n      </Buttons>\n      <StreamRooms>\n        <StreamRoom id=\"local-user\" user={localUser} />\n        {remoteUsers?.map(user => (\n          <StreamRoom key={user.uid} user={user} />\n        ))}\n      </StreamRooms>\n    </Wrapper>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}